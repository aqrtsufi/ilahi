import{s as R,g as v,c as g,r as $,l as I,a as T,b as O,d as K,e as G,f as W,i as Z,h as q,j as A,k as L}from"./firebase-D94Diavo.js";import{_ as H}from"./SongList.vue_vue_type_style_index_0_lang-HCyqtHXL.js";import{d as J,r as p,o as Q,e as n,g as t,f as B,p as M,l as X,t as _,F,i as D,k as l}from"./vue-Car_zgcF.js";import"./main-KjWYwdFc.js";import"./pdf-DFMvyHOF.js";import"./fa-CoSJ4QZC.js";async function Y(){try{await R(N);const c=await v(g(h,"books")),m=new Set(c.docs.map(o=>o.data().id)),r=$(V,"ilahiBooks"),u=await I(r);for(const o of u.items){if(m.has(o.name))continue;const e=await T(o),f={id:o.name,name:o.name.replace(/\.[^/.]+$/,""),mimeType:o.name.endsWith(".pdf")?"application/pdf":"folder",downloadUrl:e};try{const d=await O(g(h,"books"),f)}catch(d){console.error(`Error adding metadata for ${f.name}:`,d)}}}catch(c){console.error("Error in uploadBookMetadata:",c)}}const oo={apiKey:"AIzaSyDOM_RAFKDV6x35Rd55V3ihLh7PdZF9i-A",authDomain:"ilahi-90311.firebaseapp.com",projectId:"ilahi-90311",storageBucket:"ilahi-90311.appspot.com",messagingSenderId:"355868319997",appId:"1:355868319997:web:d1fa4733d107a6cd825e94",measurementId:"G-C9L97S35V5"},x=Z(oo),h=K(x),V=W(x),N=G(x);q(x);async function to(){const c=g(h,"books"),m=await v(c),r={};m.docs.forEach(o=>{const e=o.data();e.id&&(r[e.id]||(r[e.id]=[]),r[e.id].push(o.id))});let u=0;for(const o of Object.values(r))if(o.length>1)for(let e=1;e<o.length;e++)await A(L(c,o[e])),u++;return u}async function eo(c="ilahiBooks"){try{await R(N)}catch{}const m=$(V,c),{items:r}=await I(m),u=new Set(r.map(d=>d.name)),o=g(h,"books"),e=await v(o);let f=0;for(const d of e.docs){const b=d.data(),w=b==null?void 0:b.id;(!w||!u.has(w))&&(await A(L(o,d.id)),f++)}return f}async function ao(){const c=g(h,"books"),m=await v(c);let r=0;for(const u of m.docs)await A(L(c,u.id)),r++;return r}const so={class:"container mx-auto p-4 relative"},no={key:0,class:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50"},lo={class:"bg-white dark:bg-gray-900 p-6 rounded-lg max-w-4xl w-full relative"},io={key:1,class:"text-center text-xl"},ro={key:2,class:"text-center text-xl text-red-600"},co={key:3,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},uo={class:"text-xl font-semibold mb-2"},mo=["href"],fo={class:"text-xl font-semibold mb-2"},po=["onClick"],bo={key:4,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},ko={class:"p-4 rounded-lg max-w-3xl w-full"},go={class:"text-2xl font-bold mb-4"},ho={class:"grid grid-cols-2 gap-4"},vo=["src","alt"],wo={key:5,class:"mt-6 flex flex-wrap gap-3"},yo=["disabled"],_o={key:0,"aria-live":"polite"},xo={key:1},Mo=J({__name:"BooksView",setup(c){const m=p([]),r=p([]),u=p(!0),o=p(""),e=p(!1),f=p(null),d=p(!1),b=p(!1),w=p(!1),U=async()=>{d.value=!0;try{await Y(),alert("Book metadata uploaded successfully!"),await y()}catch(a){console.error("Error uploading metadata:",a),alert("Failed to upload book metadata. Check console for details.")}finally{d.value=!1}},E=async()=>{const a=await to();alert(`${a} duplicate book entries removed.`)},j=async()=>{if(!confirm("Remove Firestore docs that do not have a file in Storage?"))return;const a=await eo("ilahiBooks");alert(`Removed ${a} missing entries from Firestore.`),await y()},z=async()=>{if(!confirm("This will delete ALL book documents from Firestore. Continue?"))return;const a=await ao();alert(`Deleted ${a} docs from Firestore.`),await y()},y=async()=>{try{const a=g(h,"books"),C=(await v(a)).docs.map(k=>k.data());m.value=C.filter(k=>k.mimeType==="application/pdf")}catch(a){console.error("Error fetching books:",a),o.value="Failed to load books. Please try again later."}finally{u.value=!1}},P=a=>{f.value=a,e.value=!0};return Q(y),(a,s)=>{var k,S;const C=X("font-awesome-icon");return l(),n("div",so,[t("button",{class:"absolute top-4 right-4 text-2xl z-50",onClick:s[0]||(s[0]=i=>a.$router.push({name:"NaatList"})),"aria-label":"Open Naat list"},[M(C,{icon:["fas","door-open"]})]),b.value?(l(),n("div",no,[t("div",lo,[t("button",{class:"absolute top-2 right-2 text-xl",onClick:s[1]||(s[1]=i=>b.value=!1),"aria-label":"Close Naat list"},s[3]||(s[3]=[t("i",{class:"fa-solid fa-xmark"},null,-1)])),M(H,{filePath:"naat.txt"})])])):B("",!0),s[6]||(s[6]=t("h1",{class:"text-3xl font-bold mb-6"},"ilahi Books",-1)),u.value?(l(),n("div",io,"Loading books...")):o.value?(l(),n("div",ro,_(o.value),1)):(l(),n("div",co,[(l(!0),n(F,null,D(m.value,i=>(l(),n("div",{key:i.id,class:"shadow-lg rounded-lg p-4"},[t("h2",uo,_(i.name),1),s[4]||(s[4]=t("p",{class:"text-gray-600 mb-4"},"PDF Format",-1)),t("a",{href:i.downloadUrl,target:"_blank",rel:"noopener noreferrer",class:"btn btn-primary"}," View PDF ",8,mo)]))),128)),(l(!0),n(F,null,D(r.value,i=>(l(),n("div",{key:i.id,class:"shadow-lg rounded-lg p-4"},[t("h2",fo,_(i.name),1),s[5]||(s[5]=t("p",{class:"text-gray-600 mb-4"},"Image-based Book",-1)),t("button",{onClick:Co=>P(i),class:"btn btn-secondary"}," View Book ",8,po)]))),128))])),e.value?(l(),n("div",bo,[t("div",ko,[t("h2",go,_((k=f.value)==null?void 0:k.name),1),t("div",ho,[(l(!0),n(F,null,D((S=f.value)==null?void 0:S.images,i=>(l(),n("img",{key:i.id,src:i.downloadUrl,alt:i.name,class:"w-full h-auto"},null,8,vo))),128))]),t("button",{onClick:s[2]||(s[2]=i=>e.value=!1),class:"mt-4 btn btn-primary"},"Close")])])):B("",!0),w.value?(l(),n("div",wo,[t("button",{onClick:U,class:"btn btn-primary",disabled:d.value,"aria-label":"Upload new book metadata from Firebase Storage"},[d.value?(l(),n("span",_o,"Uploading...")):(l(),n("span",xo,"Upload Book Metadata"))],8,yo),t("button",{onClick:E,disabled:"",class:"btn btn-warning","aria-label":"Remove duplicate book metadata"}," Remove Duplicate Books "),t("button",{onClick:j,class:"btn btn-outline","aria-label":"Remove Firestore entries for missing Storage files"}," Cleanup Missing (Storage vs Firestore) "),t("button",{onClick:z,class:"btn btn-error","aria-label":"Delete ALL book entries"}," Delete ALL Books (Firestore) ")])):B("",!0)])}}});export{Mo as default};
