import{d as Z,r as f,w as te,e as b,g as t,F as U,i as O,A as _,t as S,B as R,k as v,L as ee,c as j,o as oe,f as F,p as J,m as L,s as I,n as K,M as Q}from"./vue-BEpEtYa0.js";import{u as ae,f as X}from"./main-zBpTFEO-.js";import{P as le,r as se}from"./pdf-DFMvyHOF.js";import{e as ne,a as G,c as re,b as ie,d as de,u as ue,f as ce,F as ge,h as T}from"./pdfBookUtils-BUE_LEbP.js";import"./fa-D4k8ZL7i.js";async function M(C,g=!1,p,n){var H,W,Y;const l=[],w=C.length*2;let c=0;const i=$=>{l.push($),c++,p&&p(Math.min(99,c/w*100))};i("Generating full book PDF");const u=await le.create(),h=await ne(u,ge);i("Creating cover image");const P=await G(u,"https://raw.githubusercontent.com/yashineonline/ilahiRepository/main/cover.png"),y=u.addPage(),{width:s,height:o}=y.getSize();y.drawImage(P,{x:0,y:0,width:s,height:o}),i("Creating original cover content");const d=await re(u,h,"ilahi Book",g);i("Creating second image");const m=await G(u,"https://raw.githubusercontent.com/yashineonline/ilahiRepository/main/poem.png"),x=u.addPage();x.drawImage(m,{x:0,y:0,width:s,height:o}),i("Creating Zikr quote page");const A=u.addPage();A.drawText(`
    Now when you do the Zikr:
    empty your mind,
    connect yourself to the Energy
    and live some ecstasy.
    Live the Energy of Allah.
    - Es-Seyyid Es-Shaykh Taner Vargonen el Ansari
  `,{x:50,y:o-100,size:14,font:h,color:se(0,0,0)}),i("Creating third image");const V=await G(u,"https://raw.githubusercontent.com/yashineonline/ilahiRepository/main/names.png"),B=u.addPage();B.drawImage(V,{x:0,y:0,width:s,height:o}),i("Creating table of contents");const D=await ie(u,h,C);let N=1;const r=[],e=[y,d,x,A,B,...D];for(const $ of C){i(`Processing song: ${$.title}`),r.push(N);const z=await de(u,$,n);i(`Generated ${z.length} pages for song: ${$.title}`),e.push(...z),N+=z.length}i("Updating table of contents"),await ue(D,r,h);const a=5+D.length;i("Adding page numbers and draft statement");const k=(H=n==null?void 0:n.border)!=null&&H.enabled?((W=n==null?void 0:n.border)!=null&&W.imageUrl?((Y=n==null?void 0:n.border)==null?void 0:Y.imageInset)??18:36)+6:0;ce(e,h,1,a,k),i("Saving PDF");const E=await u.save();return p&&p(100),{pdfBytes:E,logs:l}}const be={class:"space-y-2"},ve=["for"],me=["id","max","aria-label","onUpdate:modelValue","onChange","onBlur"],pe={class:"flex-grow text-base-content"},fe=["onClick"],he=Z({__name:"SelectedSongsManager",props:{selectedSongs:{}},emits:["update:selectedSongs","generate-book"],setup(C,{emit:g}){const p=C,n=g,l=f(p.selectedSongs.map((s,o)=>({...s,order:s.order??o+1}))),w=f(!1);te(()=>p.selectedSongs,(s,o)=>{w.value||s===o||(l.value=s.map((d,m)=>({...d,order:d.order??m+1})))},{deep:!1});function c(s,o,d){return Math.max(o,Math.min(d,s))}function i(){const s=l.value.map((o,d)=>({s:o,i:d,o:Number(o.order)||d+1}));s.sort((o,d)=>o.o-d.o||o.i-d.i),s.forEach((o,d)=>{o.s.order=d+1}),l.value=s.map(o=>o.s),n("update:selectedSongs",l.value)}function u(s){const o=Number(l.value[s].order);l.value[s].order=c(isFinite(o)?Math.round(o):s+1,1,l.value.length),i(),w.value=!1}function h(s){l.value.splice(s,1),y()}function P(){l.value.sort((s,o)=>s.title.localeCompare(o.title)),y()}function y(){l.value.forEach((s,o)=>{s.order=o+1}),n("update:selectedSongs",l.value)}return(s,o)=>(v(),b("div",null,[o[2]||(o[2]=t("p",{class:"text-lg mb-2"},"Set the order for your selected ilahis.",-1)),t("div",be,[o[1]||(o[1]=t("div",{class:"flex items-center mb-2 font-semibold"},[t("span",{class:"w-24 mr-2"},"Order"),t("span",{class:"flex-grow"},"Title"),t("span",{class:"w-10"})],-1)),(v(!0),b(U,null,O(l.value,(d,m)=>(v(),b("div",{key:d.title,class:"flex items-center"},[t("label",{for:`order-${m}`,class:"sr-only"},"Order for "+S(d.title),9,ve),_(t("input",{id:`order-${m}`,class:"input input-bordered w-24 mr-2",type:"number",min:1,max:l.value.length,"aria-label":`Order for ${d.title}`,"onUpdate:modelValue":x=>d.order=x,onFocus:o[0]||(o[0]=x=>w.value=!0),onChange:x=>u(m),onBlur:x=>u(m)},null,40,me),[[R,d.order,void 0,{lazy:!0,number:!0}]]),t("span",pe,S(d.title),1),t("button",{class:"btn btn-ghost btn-xs text-error ml-2",type:"button",onClick:x=>h(m),"aria-label":"Remove {{ song.title }}",title:"Remove"}," × ",8,fe)]))),128))]),t("div",{class:"mt-4 flex gap-2"},[t("button",{onClick:P,class:"btn btn-outline btn-primary"},"Sort A–Z"),t("button",{onClick:y,class:"btn btn-outline"},"Renumber 1..N")])]))}}),ye={class:"w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700 overflow-hidden"},we={class:"text-center mt-2"},xe=Z({__name:"ProgressBar",props:{progress:{}},setup(C){return(g,p)=>(v(),b(U,null,[t("div",ye,[t("div",{class:"bg-blue-400 h-2.5 rounded-full",style:ee({width:`${Math.min(100,g.progress)}%`})},null,4)]),t("div",we,S(Math.min(100,Math.round(g.progress)))+"%",1)],64))}}),ke={class:"w-full max-w-4xl mx-auto p-6 bg-base-100 text-base-content rounded-lg space-y-4"},Se={key:0,class:"text-center"},Ce={key:1,class:"space-y-2"},Pe=["disabled"],_e=["disabled"],Be=["disabled"],De=["disabled"],$e={key:2,class:"mt-4"},Fe={class:"space-y-2"},Ie=["onClick"],Ae={key:0,class:"mt-4"},Ne={class:"mt-4 space-y-3"},Te={class:"flex items-center gap-3"},Me={class:"label cursor-pointer"},Re={class:"label cursor-pointer"},Ue={class:"label cursor-pointer"},Ve={key:0,class:"flex items-center gap-3"},Ee={key:1,class:"flex items-center gap-3"},ze={class:"mt-4 space-x-2"},Le=["disabled"],Qe={class:"modal-box"},Ge={class:"py-4"},Ze={class:"modal-action"},Je=Z({__name:"BookView",setup(C){const g=ae(),p=f(!1),n=f([]),l=f(!1),w=f(!1),c=f(0),i=f("none"),u=f("#999999"),h=f(1),P=f(18),y=f(null);function s(r){var k;const e=(k=r.target.files)==null?void 0:k[0];if(!e)return;const a=new FileReader;a.onload=()=>{y.value=a.result},a.readAsDataURL(e)}function o(r){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(r);return e?[parseInt(e[1],16)/255,parseInt(e[2],16)/255,parseInt(e[3],16)/255]:[.6,.6,.6]}const d=j(()=>X(g.songs,["basic"])),m=j(()=>X(g.songs,["intermediate"]));oe(async()=>{g.songs.length===0&&(l.value=!0,await g.fetchSongs(),l.value=!1)});const x=r=>{w.value=!0},A=async()=>{if(w.value=!1,g.songs.length===0){alert("No songs available. Please try again later.");return}l.value=!0,c.value=0;try{const{pdfBytes:r,logs:e}=await M(g.songs,!1,a=>{c.value=a});c.value=99,await T(r,"AQRT_ilahi_DraftBook.pdf"),c.value=100}catch(r){console.error("Error generating PDF:",r),alert("An error occurred while generating the PDF. Please try again later.")}finally{l.value=!1}},q=async()=>{if(d.value.length===0){alert("No basic ilahis available. Please try again later.");return}l.value=!0,c.value=0;try{const r=[...d.value].sort((k,E)=>(k.order||999999)-(E.order||999999)),{pdfBytes:e,logs:a}=await M(r,!1,k=>{c.value=k});c.value=99,await T(e,"AQRT_Basic_ilahi.pdf"),c.value=100}catch(r){console.error("Error generating PDF:",r),alert("An error occurred while generating the PDF. Please try again later.")}finally{l.value=!1}},V=async()=>{if(m.value.length===0){alert("No intermediate ilahis available. Please try again later.");return}l.value=!0,c.value=0;try{const{pdfBytes:r,logs:e}=await M(m.value,!1,a=>{c.value=a});c.value=99,await T(r,"AQRT_Intermediate_ilahi.pdf"),c.value=100}catch(r){console.error("Error generating PDF:",r),alert("An error occurred while generating the PDF. Please try again later.")}finally{l.value=!1}},B=async()=>{if(n.value.length===0){alert("Please select at least one song for your custom book.");return}l.value=!0;const r=i.value==="none"?void 0:i.value==="line"?{border:{enabled:!0,color:o(u.value),width:h.value}}:y.value?{border:{enabled:!0,imageUrl:y.value,imageInset:P.value}}:void 0,{pdfBytes:e}=await M(n.value,!0,void 0,r);await T(e,"AQRT_Custom_ilahi_Book.pdf"),l.value=!1},D=r=>{n.value.findIndex(a=>a.title===r.title)===-1?n.value=[...n.value,r]:n.value=n.value.filter(a=>a.title!==r.title)},N=()=>{n.value=[],p.value=!0};return(r,e)=>(v(),b(U,null,[t("div",ke,[e[22]||(e[22]=t("h1",{class:"text-2xl font-bold"},"ilahi Book",-1)),e[23]||(e[23]=t("p",null,"Download our collection of ilahis as a PDF book.",-1)),l.value?(v(),b("div",Se,[e[10]||(e[10]=t("p",null,"Loading... Please wait.",-1)),J(xe,{progress:c.value},null,8,["progress"])])):(v(),b("div",Ce,[t("button",{onClick:q,disabled:l.value,class:"px-4 py-2 bg-base-100 text-blue-600 border border-blue-600 rounded hover:bg-blue-600 hover:text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed"}," Download "+S(d.value.length)+" Basic ilahis ",9,Pe),t("button",{onClick:V,disabled:l.value,class:"px-4 py-2 bg-base-100 text-red-600 border border-red-600 rounded hover:bg-red-600 hover:text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},S(m.value.length)+" ilahis (including Basic) ",9,_e),t("button",{onClick:e[0]||(e[0]=a=>p.value=!0),disabled:l.value,class:"px-4 py-2 bg-base-100 text-purple-600 border border-purple-600 rounded hover:bg-purple-600 hover:text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed"}," Create Custom Book ",8,Be),t("button",{onClick:e[1]||(e[1]=a=>x()),disabled:l.value,class:"px-4 py-2 bg-base-100 text-green-600 border border-green-600 rounded hover:bg-green-600 hover:text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},S(L(g).songs.length)+" ilahis ",9,De)])),p.value&&!l.value?(v(),b("div",$e,[e[21]||(e[21]=t("h2",{class:"text-xl font-semibold mb-2"},[I(" Select ilahis below by tapping on them in the order that you would like for your custom book."),t("br"),I(" Then scroll down to generate the book as a PDF. ")],-1)),t("div",Fe,[(v(!0),b(U,null,O(L(g).songs,a=>(v(),b("button",{key:a.title,onClick:k=>D(a),class:K(["w-full text-left px-4 py-2 rounded transition-colors"]),style:ee(n.value.includes(a)?"background-color: #9333ea; color: #4ade80;":"background-color: white; color: #9333ea; border: 1px solid #9333ea;")},S(a.title),13,Ie))),128))]),n.value.length>0?(v(),b("div",Ae,[J(he,{selectedSongs:n.value,"onUpdate:selectedSongs":e[2]||(e[2]=a=>n.value=a),onGenerateBook:B},null,8,["selectedSongs"])])):F("",!0),t("div",Ne,[e[20]||(e[20]=t("h3",{class:"font-semibold"},"Optional page border",-1)),t("div",Te,[t("label",Me,[_(t("input",{type:"radio",class:"radio",value:"none","onUpdate:modelValue":e[3]||(e[3]=a=>i.value=a)},null,512),[[Q,i.value]]),e[11]||(e[11]=I()),e[12]||(e[12]=t("span",{class:"ml-2"},"None",-1))]),t("label",Re,[_(t("input",{type:"radio",class:"radio",value:"line","onUpdate:modelValue":e[4]||(e[4]=a=>i.value=a)},null,512),[[Q,i.value]]),e[13]||(e[13]=I()),e[14]||(e[14]=t("span",{class:"ml-2"},"Line",-1))]),t("label",Ue,[_(t("input",{type:"radio",class:"radio",value:"image","onUpdate:modelValue":e[5]||(e[5]=a=>i.value=a)},null,512),[[Q,i.value]]),e[15]||(e[15]=I()),e[16]||(e[16]=t("span",{class:"ml-2"},"Image",-1))])]),i.value==="line"?(v(),b("div",Ve,[e[17]||(e[17]=t("label",{class:"label"},"Color",-1)),_(t("input",{type:"color","onUpdate:modelValue":e[6]||(e[6]=a=>u.value=a),class:"input input-bordered w-24"},null,512),[[R,u.value]]),e[18]||(e[18]=t("label",{class:"label ml-4"},"Width",-1)),_(t("input",{type:"number",min:"0.5",step:"0.5","onUpdate:modelValue":e[7]||(e[7]=a=>h.value=a),class:"input input-bordered w-24"},null,512),[[R,h.value,void 0,{number:!0}]])])):F("",!0),i.value==="image"?(v(),b("div",Ee,[t("input",{type:"file",accept:"image/*",onChange:s,class:"file-input file-input-bordered"},null,32),e[19]||(e[19]=t("label",{class:"label ml-4"},"Inset (px)",-1)),_(t("input",{type:"number",min:"0",step:"1","onUpdate:modelValue":e[8]||(e[8]=a=>P.value=a),class:"input input-bordered w-24"},null,512),[[R,P.value,void 0,{number:!0}]])])):F("",!0)]),t("div",ze,[n.value.length>0?(v(),b("button",{key:0,onClick:B,disabled:l.value,class:"px-4 py-2 bg-base-100 text-green-600 border border-green-600 rounded hover:bg-green-600 hover:text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed"}," Download My Custom Book ",8,Le)):F("",!0),t("button",{onClick:N,class:"px-4 py-2 bg-base-100 text-red-600 border border-red-600 rounded hover:bg-red-600 hover:text-white transition-colors"}," Reset Selection ")])])):F("",!0)]),t("div",{class:K(["modal",{"modal-open":w.value}])},[t("div",Qe,[e[24]||(e[24]=t("h3",{class:"font-bold text-lg"},"Confirm Download",-1)),t("p",Ge,"Are you sure you want to download all "+S(L(g).songs.length)+" ilahis?",1),t("div",Ze,[t("button",{onClick:A,class:"btn btn-primary"},"Yes, Download them all!"),t("button",{onClick:e[9]||(e[9]=a=>w.value=!1),class:"btn"},"No, this is too much!")])])],2)],64))}});export{Je as default};
